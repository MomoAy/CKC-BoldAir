<!doctype html>
<html th:with="tabTitle='gestion bénévoles'" lang="fr">

<head th:replace="~{_fragments/layout :: head(${tabTitle})}">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../static/css/styles.css" />

  <!-- Style personnalisé intégré -->

</head>

<body>

  <header th:replace="~{_fragments/layout :: header}"></header>

    <!-- Message d'alerte -->
    <div th:replace="~{_fragments/component :: alert}"></div>

  <main class="container-fluid my-4">

    <div class="row justify-content-center">
      <div class="search-container">
        <!-- -->
        <!-- Contenu de la page -->
        <!-- -->
        <h2>Gestion des bénévoles</h2>

        <!-- Bouton Ajouter -->
        <div class="d-flex justify-content-end">
          <a title="Ajouter" class="btn btn-primary fw-bold px-3"><i class="bi-plus-lg"></i></a>
        </div>

        <input type="text" id="searchBenevoles" onkeyup="filterTable('searchBenevoles', 'tableBenevoles')"
          placeholder="Rechercher un bénévole...">
        <table id="tableBenevoles">

          <thead>
            <tr>
              <th onclick="sortTable('tableBenevoles', 0)">Nom</th>
              <th onclick="sortTable('tableBenevoles', 1)">Prenom</th>
              <th onclick="sortTable('tableBenevoles', 1)">Email</th>
              <th onclick="sortTable('tableBenevoles', 1)">Téléphone</th>
              <th onclick="sortTable('tableBenevoles', 1)">Disponibilité</th>
              <th onclick="sortTable('tableBenevoles', 1)">type</th>
              <th onclick="sortTable('tableBenevoles', 2)">Poste</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            <tr th:each="ben : ${benevoles}">
              <form th:action="@{'/poste/affect-poste-to-benevole/' + ${ben.idBen}}" method="post">
                <td th:text="${ben.nomBen}"></td>
                <td th:text="${ben.prenom}"></td>
                <td th:text="${ben.email}"></td>
                <td th:text="${ben.telephone}"></td>
                <td th:text="${#dates.format(ben.disponibilite, 'EEEE dd MMMM yyyy')}"></td>
                <td th:text="${ben.type}"></td>

                <td>
                  <select name="idP">
                    <option th:value="${poste.idP}" th:each="poste : ${postes}" th:text="${poste.nom}" th:selected="${poste.idP} == ${ben.idBen}"></option>
                  </select>
                </td>

                <td><button type="submit" id="btn1">Mettre à jour</button></td>

                <td class="py-0 text-center" style="font-size: 1.2rem;">
                  <a title="Modifier" th:href="@{/compte/form_benevole(id=*{idCompte})}"
                    class="text-secondary bi-pencil-square"></a>&nbsp;
                  <a title="Supprimer" th:data-id="*{idCompte}" th:data-name="*{pseudo}" onclick="confirm_delete(this)"
                    class="text-secondary bi-trash3" style=" cursor:pointer;"></a>
                </td>
              </form>
            </tr>
          </tbody>

        </table>
        <!-- Fin Contenu de la page -->

      </div>
    </div>
  </main>

  <footer th:replace="~{_fragments/layout :: footer}"></footer>
  <th:block th:replace="~{_fragments/layout :: bottom-scripts}"></th:block>

  <script>
    function afficherBouton(id) {
      document.getElementById(id).classList.add('visible');
    }

    function filterTable(inputId, tableId) {
      const input = document.getElementById(inputId);
      const filter = input.value.toLowerCase();
      const table = document.getElementById(tableId);
      const tr = table.getElementsByTagName("tr");

      for (let i = 1; i < tr.length; i++) {
        const tds = tr[i].getElementsByTagName("td");
        let visible = false;
        for (let j = 0; j < tds.length; j++) {
          if (tds[j].textContent.toLowerCase().indexOf(filter) > -1) {
            visible = true;
            break;
          }
        }
        tr[i].style.display = visible ? "" : "none";
      }
    }

    function sortTable(tableId, colIndex) {
      const table = document.getElementById(tableId);
      const rows = Array.from(table.rows).slice(1);
      const asc = table.getAttribute("data-sort-dir") !== "asc";

      rows.sort((a, b) => {
        const cellA = a.cells[colIndex].innerText.toLowerCase();
        const cellB = b.cells[colIndex].innerText.toLowerCase();
        return asc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
      });

      rows.forEach(row => table.appendChild(row));
    }