<!doctype html>
<html th:with="tabTitle='Accueil'" lang="fr">

<head th:replace="~{_fragments/layout :: head(${tabTitle})}">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../static/css/styles.css" />
</head>

<script>
  function afficherBouton(id) {
    document.getElementById(id).classList.add('visible');
  }

  function filterTable(inputId, tableId) {
    const input = document.getElementById(inputId);
    const filter = input.value.toLowerCase();
    const table = document.getElementById(tableId);
    const tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) {
      const tds = tr[i].getElementsByTagName("td");
      let visible = false;
      for (let j = 0; j < tds.length; j++) {
        if (tds[j].textContent.toLowerCase().indexOf(filter) > -1) {
          visible = true;
          break;
        }
      }
      tr[i].style.display = visible ? "" : "none";
    }
  }

  function sortTable(tableId, colIndex) {
    const table = document.getElementById(tableId);
    const rows = Array.from(table.rows).slice(1);
    const asc = table.getAttribute("data-sort-dir") !== "asc";

    rows.sort((a, b) => {
      const cellA = a.cells[colIndex].innerText.toLowerCase();
      const cellB = b.cells[colIndex].innerText.toLowerCase();
      return asc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
    });

    rows.forEach(row => table.appendChild(row));
    table.setAttribute("data-sort-dir", asc ? "asc" : "desc");
  }
</script>

<body>

  <!-- En-tête de page -->
  <header th:replace="~{_fragments/layout :: header }"></header>

  <main class="container-fluid my-4">
    <h2 class="text-center mb-4">Gestion des participants</h2>

    <div class="row justify-content-center">
      <!-- Formulaire à gauche -->
      <div class="col-lg-4 col-md-5">
        <div class="card shadow p-4">
          <h4 class="mb-3 text-center">Ajouter un participant</h4>
          <form th:action="@{/participant/ajouter}" method="post">
            <div class="mb-3">
              <label for="nom" class="form-label">Nom :</label>
              <input type="text" class="form-control" id="nom" name="nom" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email :</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
              <label for="evenement" class="form-label">Événement :</label>
              <input type="text" class="form-control" id="evenement" name="evenement" required>
            </div>
            <div class="mb-3">
              <label for="etat" class="form-label">État d'inscription :</label>
              <select class="form-select" id="etat" name="etat">
                <option>En cours</option>
                <option>Validé</option>
                <option>Refusé</option>
              </select>
            </div>
            <button type="submit" class="btn btn-info text-white w-100">Ajouter</button>
          </form>
        </div>
      </div>

      <!-- Tableau à droite -->
      <div class="col-lg-8 col-md-7">
        <input type="text" id="searchParticipants" onkeyup="filterTable('searchParticipants', 'tableParticipants')"
          class="form-control mb-3" placeholder="Rechercher un participant...">

        <div class="table-responsive">
          <table class="table table-bordered" id="tableParticipants">
            <thead>
              <tr>
                <th onclick="sortTable('tableParticipants', 0)">Nom</th>
                <th onclick="sortTable('tableParticipants', 1)">Email</th>
                <th onclick="sortTable('tableParticipants', 2)">Événement</th>
                <th>État d'inscription</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Sophie Durand</td>
                <td>sophie@mail.com</td>
                <td>Canoë Jeune</td>
                <td>
                  <select onchange="afficherBouton('btn3')">
                    <option>En cours</option>
                    <option>Validé</option>
                    <option>Refusé</option>
                  </select>
                </td>
                <td><button id="btn3" class="btn btn-info btn-sm text-white">Mettre à jour</button></td>
              </tr>
              <tr>
                <td>Antoine Leblanc</td>
                <td>antoine@mail.com</td>
                <td>Slalom Régional</td>
                <td>
                  <select onchange="afficherBouton('btn4')">
                    <option>En cours</option>
                    <option>Validé</option>
                    <option>Refusé</option>
                  </select>
                </td>
                <td><button id="btn4" class="btn btn-info btn-sm text-white">Mettre à jour</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>


  <footer th:replace="~{_fragments/layout :: footer}"> </footer>
  <th:block th:replace="~{_fragments/layout :: bottom-scripts}"></th:block>
</body>

</html>